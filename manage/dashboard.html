<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FASTRESP - 系统大盘</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/antd/4.24.14/antd.min.css" />
    <link rel="stylesheet" href="_style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.43/moment-timezone-with-data.min.js"></script>
    <script src="https://www.w3schools.com/lib/w3.js"></script>
    <script src="_common.js"></script>
    <script src="_chat.js"></script>
    <style>
        /* Dashboard 特定样式 */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(16.25em, 1fr)); gap: 1.25em; }
        .card { background: linear-gradient(135deg, #ffffff, #f9fafb); padding: 1.25em; border-radius: 0.75em; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15); background: #f5f5f5; }
        .card:active { background: #e5e7eb; transform: translateY(0); }
        .card-title { font-size: 1.1em; font-weight: 600; margin-bottom: 0.5em; color: #1f2937; }
        .card-content { font-size: 1.75em; font-weight: 700; color: #f97316; margin-bottom: 0.25em; }
        .card-subtext { font-size: 0.85em; color: #6b7280; font-style: italic; }
        .charts-section { margin-top: 2.5em; }
        .charts-container { display: flex; gap: 1.25em; margin-top: 0.75em; justify-content: space-between; }
        .chart-card { background: #fff; padding: 1em; border-radius: 0.5em; box-shadow: 0 0.125em 0.5em rgba(0, 0, 0, 0.1); width: calc(50% - 0.625em); }
        .chart-title { font-size: 1em; font-weight: 500; margin-bottom: 0.75em; }
        canvas { max-width: 100%; height: auto; }
        .time-filter { margin-bottom: 0.75em; display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
        .brand-service-filter { margin-bottom: 0.75em; display: flex; gap: 8px; flex-shrink: 0; }

        /* 平台热门样式 */
        .hot-section { margin-top: 2.5em; }
        .hot-filter { display: flex; gap: 1em; margin-bottom: 1em; flex-wrap: nowrap; overflow-x: auto; white-space: nowrap; }
        .hot-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.25em; }
        .hot-card { background: linear-gradient(135deg, #ffffff, #f9fafb); padding: 1.25em; border-radius: 0.75em; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); overflow-x: auto; }
        .hot-header-container { margin-bottom: 0.5em; }
        .hot-title { font-size: 1.1em; font-weight: 600; margin-bottom: 0.75em; color: #1f2937; }
        .hot-header { display: flex; background: #f1f5f9; padding: 0.5em 0; font-weight: 500; color: #4b5563; border-bottom: 1px solid #e5e7eb; }
        .hot-header div { text-align: center; white-space: nowrap; }
        .hot-header div:nth-child(1) { flex: 0 0 8%; }
        .hot-header div:nth-child(2) { flex: 2; }
        .hot-header div:nth-child(3) { flex: 1.5; }
        .hot-header div:nth-child(4) { flex: 1; }
        .hot-header div:nth-child(5) { flex: 1; }
        .hot-divider { height: 1px; background: #e5e7eb; margin: 0.5em 0; }
        .hot-data { max-height: 400px; overflow-y: auto; }
        .hot-row { display: flex; padding: 0.5em 0; border-bottom: 1px solid #e5e7eb; }
        .hot-row div { text-align: center; white-space: nowrap; color: #374151; }
        .hot-row div:nth-child(1) { flex: 0 0 8%; }
        .hot-row div:nth-child(2) { flex: 2; overflow: hidden; text-overflow: ellipsis; }
        .hot-row div:nth-child(3) { flex: 1.5; overflow: hidden; text-overflow: ellipsis; }
        .hot-row div:nth-child(4) { flex: 1; }
        .hot-row div:nth-child(5) { flex: 1; }
        .hot-row:hover { background: #f5f5f5; }
        .hot-link { color: #374151; text-decoration: none; }
        .hot-link:hover { color: #f97316; }
        .hot-card:nth-child(1) .hot-data::-webkit-scrollbar { width: 6px; }
        .hot-card:nth-child(1) .hot-data::-webkit-scrollbar-thumb { background: #f59e0b; border-radius: 3px; }
        .hot-card:nth-child(2) .hot-data::-webkit-scrollbar { width: 6px; }
        .hot-card:nth-child(2) .hot-data::-webkit-scrollbar-thumb { background: #8b5cf6; border-radius: 3px; }
        .hot-card:nth-child(3) .hot-data::-webkit-scrollbar { width: 6px; }
        .hot-card:nth-child(3) .hot-data::-webkit-scrollbar-thumb { background: #ec4899; border-radius: 3px; }
        .hot-card:nth-child(4) .hot-data::-webkit-scrollbar { width: 6px; }

        /* 时间筛选按钮样式 */
        .time-btn-group { display: flex; gap: 8px; flex-wrap: nowrap; overflow-x: auto; }
        .time-btn { padding: 0.25em 0.75em; border-radius: 0.25em; cursor: pointer; background: #fff; border: 0.0625em solid #d9d9d9; color: rgba(0, 0, 0, 0.85); transition: all 0.3s; font-size: 0.875em; height: 2em; line-height: 1.5em; }
        .time-btn:hover { background: #f5f5f5; border-color: #f97316; color: #f97316; }
        .time-btn.active { background: #f97316; border-color: #f97316; color: #fff; }
        .time-btn:focus { outline: none; border-color: #f97316; box-shadow: 0 0 0 0.125em rgba(249, 115, 22, 0.2); }

        /* 自定义时间输入框样式 */
        .hot-filter input[type="date"],
        .filter-row input[type="date"] {
            height: 2em;
            padding: 0.25em 0.5em;
            font-size: 0.875em;
            border: 0.0625em solid #d9d9d9;
            border-radius: 0.25em;
            box-sizing: border-box;
            vertical-align: middle;
        }

        /* 趋势统计筛选行样式 */
        .filter-row { display: flex; align-items: center; gap: 16px; flex-wrap: nowrap; overflow-x: auto; white-space: nowrap; margin-bottom: 16px; }

        /* 移动端样式调整 */
        @media (max-width: 48em) {
            .dashboard-grid { grid-template-columns: 1fr; }
            .card { padding: 1em; border-radius: 0.5em; }
            .charts-container {
                display: flex !important;
                flex-direction: column !important;
                gap: 1.25em !important;
                justify-content: flex-start !important;
            }
            .chart-card {
                width: 100% !important;
                margin: 0;
            }
            .hot-container {
                display: grid !important;
                grid-template-columns: 1fr !important;
                gap: 1.25em !important;
            }
            .hot-data { max-height: 25em; }
            .time-btn-group { gap: 4px; flex-wrap: wrap; width: 100%; justify-content: flex-start; }
            .time-btn { font-size: 0.75em; padding: 0.2em 0.5em; height: 1.8em; }
            .hot-filter input[type="date"],
            .filter-row input[type="date"] {
                height: 1.8em;
                font-size: 0.75em;
                padding: 0.2em 0.5em;
                width: 100%;
            }
            .filter-row { gap: 8px; flex-direction: column; align-items: flex-start; flex-wrap: wrap; overflow-x: initial; white-space: normal; }
            .hot-filter { flex-wrap: wrap; overflow-x: initial; white-space: normal; }
            .brand-service-filter { width: 100%; flex-direction: column; gap: 4px; }
            .brand-service-filter .ant-select { width: 100%; }
            .time-filter { width: 100%; }
        }

        /* PC端响应式设计 */
        @media (min-width: 48.0625em) {
            .charts-container { display: flex; gap: 1.25em; justify-content: space-between; }
            .chart-card { width: calc(50% - 0.625em); }
        }
    </style>
</head>
<body>
<div class="container">
    <!-- 顶部 -->
    <div id="header" w3-include-html="_header.html"></div>

    <!-- 内容区域 -->
    <div class="content-wrapper">
        <!-- 侧边栏 -->
        <div id="sidebar" w3-include-html="_sidebar.html"></div>

        <!-- 主内容区域 -->
        <div class="main-content">
            <h2 style="font-size: 20px; margin-bottom: 24px;">平台概况</h2>
            <div class="dashboard-grid"></div>

            <!-- 平台热门 -->
            <div class="hot-section">
                <h2 style="font-size: 20px; margin-bottom: 24px;">平台热门</h2>
                <div class="hot-filter">
                    <select class="ant-select" id="hotTopSelect" onchange="updateHotSection()">
                        <option value="10" selected>Top 10</option>
                        <option value="15">Top 15</option>
                        <option value="20">Top 20</option>
                        <option value="30">Top 30</option>
                        <option value="50">Top 50</option>
                        <option value="100">Top 100</option>
                    </select>
                    <div class="time-btn-group">
                        <button class="time-btn" data-range="today" onclick="updateHotSection('today')">今天</button>
                        <button class="time-btn" data-range="3" onclick="updateHotSection('3')">最近3天</button>
                        <button class="time-btn" data-range="7" onclick="updateHotSection('7')">最近1周</button>
                        <button class="time-btn" data-range="30" onclick="updateHotSection('30')">最近30天</button>
                        <button class="time-btn" data-range="60" onclick="updateHotSection('60')">最近60天</button>
                        <button class="time-btn" data-range="90" onclick="updateHotSection('90')">最近90天</button>
                        <button class="time-btn" data-range="custom" onclick="toggleHotCustomRange()">自定义</button>
                        <input type="date" class="ant-input" id="hotStartDate" onchange="updateHotCustomRange()" value="2025-03-07" style="display: none;">
                        <input type="date" class="ant-input" id="hotEndDate" onchange="updateHotCustomRange()" value="2025-03-07" style="display: none;">
                    </div>
                </div>
                <div class="hot-container"></div>
            </div>

            <!-- 趋势统计 -->
            <div class="charts-section">
                <h2 style="font-size: 20px; margin-bottom: 24px;">趋势统计</h2>
                <div class="filter-row">
                    <div class="brand-service-filter">
                        <select class="ant-select" id="brandSelect">
                            <option value="">全部品牌</option>
                            <option value="apple">苹果</option>
                            <option value="google">谷歌</option>
                            <option value="microsoft">微软</option>
                            <option value="yahoo">雅虎</option>
                            <option value="tiktok">TikTok</option>
                            <option value="facebook">Facebook</option>
                        </select>
                        <select class="ant-select" id="serviceSelect">
                            <option value="">全部服务</option>
                            <option value="account">账号</option>
                            <option value="pointcard">点卡</option>
                            <option value="equipment">装备</option>
                            <option value="article">软文</option>
                            <option value="software">软件</option>
                            <option value="membership">会员</option>
                            <option value="giftcard">礼品卡</option>
                            <option value="virtualgoods">虚拟商品</option>
                            <option value="advertising">广告</option>
                            <option value="consulting">咨询</option>
                            <option value="training">培训</option>
                            <option value="data">数据服务</option>
                        </select>
                    </div>
                    <div class="time-filter">
                        <div class="time-btn-group">
                            <button class="time-btn" data-range="3" onclick="updateTimeRange('3')">最近3天</button>
                            <button class="time-btn" data-range="7" onclick="updateTimeRange('7')">最近1周</button>
                            <button class="time-btn" data-range="30" onclick="updateTimeRange('30')">最近30天</button>
                            <button class="time-btn" data-range="60" onclick="updateTimeRange('60')">最近60天</button>
                            <button class="time-btn" data-range="90" onclick="updateTimeRange('90')">最近90天</button>
                            <button class="time-btn" data-range="custom" onclick="toggleCustomRange()">自定义</button>
                            <input type="date" class="ant-input" id="startDate" onchange="updateCustomRange()" value="2025-02-28" style="display: none;">
                            <input type="date" class="ant-input" id="endDate" onchange="updateCustomRange()" value="2025-03-07" style="display: none;">
                        </div>
                    </div>
                </div>
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-title">充值额/销售额/退款额</div>
                        <canvas id="salesMoneyChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">平均购买件数/客单价</div>
                        <canvas id="salesAvgChart"></canvas>
                    </div>
                </div>
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-title">订单数/售后数/退款订单数/工单数</div>
                        <canvas id="salesCountChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">用户平均订单数/购买数</div>
                        <canvas id="userAvgChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- 基础统计 -->
            <div class="charts-section">
                <h2 style="font-size: 20px; margin-bottom: 24px;">基础统计</h2>
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-title">新增店铺数/商品数</div>
                        <canvas id="basicStoreChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">用户注册/KYC/店铺/黑名单</div>
                        <canvas id="basicUserChart"></canvas>
                    </div>
                </div>
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-title">新增文章/博客数量</div>
                        <canvas id="basicContentChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- 投诉统计 -->
            <div class="charts-section">
                <h2 style="font-size: 20px; margin-bottom: 24px;">投诉统计</h2>
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-title">投诉数</div>
                        <canvas id="complaintChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部 -->
    <div id="footer" w3-include-html="_footer.html"></div>
</div>

<script>
    // 全局变量
    const timeRanges = { 7: 7, 30: 30, 60: 60, 90: 90 };
    let labels = Array.from({ length: 7 }, (_, i) => moment('2025-03-07').subtract(6 - i, 'days').format('YYYY-MM-DD'));
    const chartOptions = {
        responsive: true,
        maintainAspectRatio: true,
        plugins: { legend: { position: 'bottom' } },
        scales: { y: { beginAtZero: true } }
    };

    // 单项统计配置
    const dashboardStatsConfig = [
        { title: "网站流量", content: "2,345", subtext: "访问: 2,100 | 设备: 1,800 | 在线: 20", link: null, color: "#3b82f6" },
        { title: "网站用户", content: "2,345", subtext: "跳出率: 20% | 时长: 600s | 转化: 20%", link: null, color: "#3b82f6" },
        { title: "新增客户", content: "1,234", subtext: "活跃数: 890 | 付费数: 200 | 昨日: 15", link: "user.html", color: "#3b82f6" },
        { title: "实名认证", content: "50", subtext: "新增: 15 | 通过: 20 | 拒绝: 2", link: "user_kyc.html", color: "#3b82f6" },
        { title: "需求审核", content: "45", subtext: "新增: 15 | 通过: 20 | 中标: 10", link: "demand_records.html", color: "#3b82f6" },
        { title: "订单总数", content: "567", subtext: "待处理: 45 | 客单价: $120 | 客单量: 2.5", link: "orders.html", color: "#10b981" },
        { title: "订单退款", content: "22", subtext: "新增: 60 | 完结: 8 | 拒绝: 8", link: "orders_refunds.html", color: "#10b981" },
        { title: "订单换货", content: "18", subtext: "新增: 60 | 完结: 8 | 拒绝: 8", link: "orders_replacements.html", color: "#10b981" },
        { title: "工单数据", content: "45", subtext: "新增: 15 | 完结: 30 | 超时: 30", link: "orders_ticket.html", color: "#10b981" },
        { title: "客户投诉", content: "15", subtext: "新增: 15 | 完成: 30", link: "complaint.html", color: "#10b981" },
        { title: "店铺销售", content: "$12,345", subtext: "总数: 78 | 平均销售额: $158", link: "store_stat.html", color: "#8b5cf6" },
        { title: "店铺审核", content: "78", subtext: "新增: 15 | 通过: 10 | 拒绝: 2", link: "store.html", color: "#8b5cf6" },
        { title: "推广审核", content: "78", subtext: "推广中: 15 | 通过: 10 | 拒绝: 2", link: "promotion.html", color: "#8b5cf6" },
        { title: "提现审核", content: "78", subtext: "新增: 15 | 通过: 10 | 拒绝: 2", link: "store_withdrawal.html", color: "#8b5cf6" },
        { title: "FAQ审核", content: "25", subtext: "新增: 31 | 通过: 25 | 拒绝: 2", link: "store_faq.html", color: "#8b5cf6" },
        { title: "商品审核", content: "120", subtext: "新增: 95 | 完成: 35 | 拒绝: 2", link: "item.html", color: "#f59e0b" },
        { title: "博客审核", content: "40", subtext: "新增: 15 | 通过: 25 | 拒绝: 2", link: "user_blog.html", color: "#ec4899" },
        { title: "文章审核", content: "60", subtext: "新增: 315 | 通过: 215 | 拒绝: 2", link: "posts.html", color: "#ec4899" },
        { title: "充值金额", content: "$15,678", subtext: "次数: 123 | 单次均值: $127", link: "payment_record.html", color: "#14b8a6" },
        { title: "充值争议", content: "12", subtext: "新增: 31 | 完结: 15 | 涉及渠道: 3", link: "payment_dispute.html", color: "#14b8a6" },
        { title: "违规事件", content: "30", subtext: "新增: 10 | 店铺: 15 | 客户: 3", link: "violations_event.html", color: "#ef4444" },
        { title: "违规处罚", content: "25", subtext: "新增: 5 | 店铺: 18 | 客户: 12", link: "user_sanctions.html", color: "#ef4444" },
        { title: "今日排班", content: "8", subtext: "客服数: 6 | 财务数: 5 | 版次数: 3", link: "schedule.html", color: "#6366f1" },
        { title: "客服交接", content: "35", subtext: "跟进中: 20 | 已完结: 15 | 超时: 3", link: "schedule_handover.html", color: "#6366f1" },
        { title: "员工信息", content: "10", subtext: "迟到: 8 | 缺卡: 10 | 请假: 2  | 时长: 1小时", link: null, color: "#6366f1" },
    ];

    // 平台热门配置
    const hotStatsConfig = {
        "hotProducts": {
            title: "热门商品",
            headers: ["名次",  "商品名称", "客单价", "销售额"],
            data: Array.from({ length: 100 }, (_, i) => {
                const sales = Math.floor(10000 - i * 90);
                const unitPrice = Math.floor(Math.random() * 150 + 50);
                return {
                    rank: i + 1,
                    productName: ["SmartWatch Pro", "Wireless Earbuds", "Eco-Friendly Charger", "Gaming Mouse", "Fitness Tracker"][i % 5], // 真實商品名循環
                    unitPrice: `$${unitPrice}`,
                    sales: sales,
                    storeLink: `store_${["techtrend", "gizmohub", "ecomart", "gearzone", "trendytech"][i % 5]}.html`,
                    productLink: `product_${["smartwatch-pro", "wireless-earbuds", "eco-charger", "gaming-mouse", "fitness-tracker"][i % 5]}.html`
                };
            }).map((item, index) => ({
                rank: index + 1,
                productName: `<a href="${item.productLink}" class="hot-link">${item.productName}</a>`,
                unitPrice: item.unitPrice,
                sales: `$${item.sales.toLocaleString()}`
            })),
            color: "#f59e0b"
        },
        "hotStores": {
            title: "热门店铺",
            headers: ["名次", "店铺名", "客单价", "销售额"],
            data: Array.from({ length: 100 }, (_, i) => {
                const sales = Math.floor(20000 - i * 175);
                const unitPrice = Math.floor(Math.random() * 200 + 100);
                return {
                    rank: i + 1,
                    storeName: ["GreenLiving", "TechBit", "UrbanGear", "EcoTrend", "SmartShop"][i % 5], // 真實店铺名循環
                    unitPrice: `$${unitPrice}`,
                    sales: sales,
                    storeLink: `store_${["greenliving", "techbit", "urbangear", "ecotrend", "smartshop"][i % 5]}.html`
                };
            }).map((item, index) => ({
                rank: index + 1,
                storeName: `<a href="${item.storeLink}" class="hot-link">${item.storeName}</a>`,
                unitPrice: item.unitPrice,
                sales: `$${item.sales.toLocaleString()}`
            })),
            color: "#8b5cf6"
        },
        "hotArticles": {
            title: "热门文章",
            headers: ["名次", "用户名", "文章名", "点赞量"],
            data: Array.from({ length: 100 }, (_, i) => {
                const likes = Math.floor(1000 - i * 9);
                return {
                    rank: i + 1,
                    userName: ["JaneDoe", "MarkLee", "SaraKim", "TomChen", "LisaWu"][i % 5], // 真實用户名循環
                    articleName: ["Tech Trends Unveiled", "AI Revolution Insights", "Green Living Tips", "Gadget Reviews", "Future of Work"][i % 5], // 真實文章名循環
                    likes: likes,
                    userLink: `user_${["janedoe", "marklee", "sarakim", "tomchen", "lisawu"][i % 5]}.html`,
                    articleLink: `article_${["tech-trends", "ai-revolution", "green-living", "gadget-reviews", "future-work"][i % 5]}.html`
                };
            }).map((item, index) => ({
                rank: index + 1,
                userName: `<a href="${item.userLink}" class="hot-link">${item.userName}</a>`,
                articleName: `<a href="${item.articleLink}" class="hot-link">${item.articleName}</a>`,
                likes: item.likes.toLocaleString()
            })),
            color: "#ec4899"
        },
        "hotDemands": {
            title: "热门需求",
            headers: ["名次", "用户名", "需求名", "竞标数"],
            data: Array.from({ length: 100 }, (_, i) => {
                const bids = Math.floor(50 - i * 0.4);
                return {
                    rank: i + 1,
                    userName: ["AlexSmith", "EmmaBrown", "LiamJones", "OliviaWang", "NoahLi"][i % 5], // 真實用户名循環
                    demandName: ["Web Design Service", "Mobile App Dev", "SEO Optimization", "Graphic Design", "Content Writing"][i % 5], // 真實需求名循環
                    bids: bids,
                    userLink: `user_${["alexsmith", "emmabrown", "liamjones", "oliviawang", "noahli"][i % 5]}.html`,
                    demandLink: `demand_${["web-design", "mobile-app", "seo-opt", "graphic-design", "content-writing"][i % 5]}.html`
                };
            }).map((item, index) => ({
                rank: index + 1,
                userName: `<a href="${item.userLink}" class="hot-link">${item.userName}</a>`,
                demandName: `<a href="${item.demandLink}" class="hot-link">${item.demandName}</a>`,
                bids: item.bids.toLocaleString()
            })),
            color: "#3b82f6"
        }
    };

    // 格式化 subtext
    function formatSubtext(subtext) {
        return subtext.replace(/(\d+(?:,\d+)?(?:\.\d+)?(?:\$|小时|%)?)/g, '<span style="font-weight:500;color: #f97316">$1</span>');
    }

    // 生成單項統計卡片
    function generateDashboardStats() {
        const dashboardGrid = document.querySelector('.dashboard-grid');
        if (!dashboardGrid) return;
        dashboardGrid.innerHTML = '';
        dashboardStatsConfig.forEach(stat => {
            const card = document.createElement('div');
            card.className = 'card';
            card.style.borderLeft = `4px solid ${stat.color}`;
            if (stat.link) card.onclick = () => window.location.href = stat.link;
            card.innerHTML = `
            <div class="card-title">${stat.title}</div>
            <div class="card-content">${stat.content}</div>
            <div class="card-subtext">${formatSubtext(stat.subtext)}</div>
        `;
            dashboardGrid.appendChild(card);
        });
    }

    // 生成平台热门卡片
    function generateHotStats() {
        const hotContainer = document.querySelector('.hot-container');
        if (!hotContainer) return;
        hotContainer.innerHTML = '';
        const topLimit = parseInt(document.getElementById('hotTopSelect').value);

        Object.keys(hotStatsConfig).forEach(key => {
            const config = hotStatsConfig[key];
            const card = document.createElement('div');
            card.className = 'hot-card';
            card.style.borderLeft = `4px solid ${config.color}`;

            const title = document.createElement('div');
            title.className = 'hot-title';
            title.textContent = config.title;
            card.appendChild(title);

            const header = document.createElement('div');
            header.className = 'hot-header';
            header.innerHTML = config.headers.map(h => `<div>${h}</div>`).join('');
            card.appendChild(header);

            const dataList = document.createElement('div');
            dataList.className = 'hot-data';
            const limitedData = config.data.slice(0, topLimit);
            limitedData.forEach(item => {
                const row = document.createElement('div');
                row.className = 'hot-row';
                row.innerHTML = Object.values(item).map(val => `<div>${val}</div>`).join('');
                dataList.appendChild(row);
            });
            card.appendChild(dataList);

            hotContainer.appendChild(card);
        });
    }

    // 更新平台热门數據
    function updateHotSection(value) {
        const startDateInput = document.getElementById('hotStartDate');
        const endDateInput = document.getElementById('hotEndDate');
        const today = moment('2025-03-07');

        // 移除所有按钮的 active 状态
        document.querySelectorAll('.hot-filter .time-btn').forEach(btn => btn.classList.remove('active'));
        const activeBtn = document.querySelectorAll(`.hot-filter .time-btn[data-range="${value || 'today'}"]`);
        if (activeBtn) activeBtn.forEach(item =>{
            item.classList.add('active')
        });

        if (value === 'custom') {
            startDateInput.style.display = 'inline-block';
            endDateInput.style.display = 'inline-block';
        } else {
            startDateInput.style.display = 'none';
            endDateInput.style.display = 'none';
            const days = value === 'today' ? 1 : (timeRanges[value] || 1);
            const startDate = today.clone().subtract(days - 1, 'days');
            startDateInput.value = startDate.format('YYYY-MM-DD');
            endDateInput.value = today.format('YYYY-MM-DD');
            generateHotStats();
        }
    }
    // 自定义时间范围更新
    function updateHotCustomRange() {
        const startDate = moment(document.getElementById('hotStartDate').value);
        const endDate = moment(document.getElementById('hotEndDate').value);
        if (startDate.isValid() && endDate.isValid() && startDate <= endDate) {
            document.getElementById('hotTimeRangeSelect').value = 'custom';
            generateHotStats();
        }
    }

    // 图表初始化
    let charts = [];
    function initCharts() {
        charts = [
            new Chart(document.getElementById('salesMoneyChart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: '充值额', data: [100, 120, 150, 130, 140, 160, 180], backgroundColor: 'rgba(249, 115, 22, 0.3)', borderColor: 'rgba(249, 115, 22, 1)', fill: true },
                        { label: '销售额', data: [200, 220, 250, 230, 240, 260, 280], backgroundColor: 'rgba(30, 58, 138, 0.3)', borderColor: 'rgba(30, 58, 138, 1)', fill: true },
                        { label: '退款额', data: [20, 25, 30, 28, 25, 30, 35], backgroundColor: 'rgba(255, 77, 79, 0.3)', borderColor: 'rgba(255, 77, 79, 1)', fill: true }
                    ]
                },
                options: chartOptions
            }),
            new Chart(document.getElementById('salesAvgChart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: '平均购买件数', data: [5, 6, 5, 7, 6, 8, 7], backgroundColor: 'rgba(255, 215, 0, 0.3)', borderColor: 'rgba(255, 215, 0, 1)', fill: true },
                        { label: '客单价', data: [50, 55, 60, 58, 62, 65, 70], backgroundColor: 'rgba(249, 115, 22, 0.3)', borderColor: 'rgba(249, 115, 22, 1)', fill: true }
                    ]
                },
                options: chartOptions
            }),
            new Chart(document.getElementById('salesCountChart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: '订单数', data: [30, 35, 40, 38, 42, 45, 50], backgroundColor: 'rgba(249, 115, 22, 0.3)', borderColor: 'rgba(249, 115, 22, 1)', fill: true },
                        { label: '售后数', data: [5, 6, 7, 8, 6, 7, 9], backgroundColor: 'rgba(30, 58, 138, 0.3)', borderColor: 'rgba(30, 58, 138, 1)', fill: true },
                        { label: '退款订单数', data: [3, 4, 5, 4, 5, 6, 7], backgroundColor: 'rgba(255, 77, 79, 0.3)', borderColor: 'rgba(255, 77, 79, 1)', fill: true },
                        { label: '工单数', data: [10, 12, 15, 14, 13, 16, 18], backgroundColor: 'rgba(255, 215, 0, 0.3)', borderColor: 'rgba(255, 215, 0, 1)', fill: true }
                    ]
                },
                options: chartOptions
            }),
            new Chart(document.getElementById('userAvgChart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: '客户平均订单数', data: [2.5, 2.8, 3.0, 2.9, 3.2, 3.5, 3.7], backgroundColor: 'rgba(249, 115, 22, 0.3)', borderColor: 'rgba(249, 115, 22, 1)', fill: true },
                        { label: '客户平均购买数', data: [10, 12, 15, 14, 16, 18, 20], backgroundColor: 'rgba(30, 58, 138, 0.3)', borderColor: 'rgba(30, 58, 138, 1)', fill: true }
                    ]
                },
                options: chartOptions
            }),
            new Chart(document.getElementById('basicStoreChart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: '新增店铺数', data: [5, 6, 7, 8, 6, 9, 10], backgroundColor: 'rgba(249, 115, 22, 0.3)', borderColor: 'rgba(249, 115, 22, 1)', fill: true },
                        { label: '新增商品数', data: [20, 25, 30, 28, 32, 35, 40], backgroundColor: 'rgba(30, 58, 138, 0.3)', borderColor: 'rgba(30, 58, 138, 1)', fill: true }
                    ]
                },
                options: chartOptions
            }),
            new Chart(document.getElementById('basicUserChart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: '客户注册', data: [50, 55, 60, 58, 62, 65, 70], backgroundColor: 'rgba(249, 115, 22, 0.3)', borderColor: 'rgba(249, 115, 22, 1)', fill: true },
                        { label: 'KYC', data: [10, 12, 15, 14, 13, 16, 18], backgroundColor: 'rgba(30, 58, 138, 0.3)', borderColor: 'rgba(30, 58, 138, 1)', fill: true },
                        { label: '新增店铺数', data: [5, 6, 7, 8, 6, 9, 10], backgroundColor: 'rgba(255, 77, 79, 0.3)', borderColor: 'rgba(255, 77, 79, 1)', fill: true },
                        { label: '黑名单', data: [2, 3, 4, 3, 5, 4, 6], backgroundColor: 'rgba(255, 215, 0, 0.3)', borderColor: 'rgba(255, 215, 0, 1)', fill: true }
                    ]
                },
                options: chartOptions
            }),
            new Chart(document.getElementById('basicContentChart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: '新增文章数量', data: [15, 18, 20, 22, 19, 23, 25], backgroundColor: 'rgba(249, 115, 22, 0.3)', borderColor: 'rgba(249, 115, 22, 1)', fill: true },
                        { label: '新增博客数量', data: [3, 4, 5, 6, 4, 7, 8], backgroundColor: 'rgba(30, 58, 138, 0.3)', borderColor: 'rgba(30, 58, 138, 1)', fill: true }
                    ]
                },
                options: chartOptions
            }),
            new Chart(document.getElementById('complaintChart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: '投诉总数', data: [15, 17, 20, 18, 19, 22, 25], backgroundColor: 'rgba(255, 77, 79, 0.3)', borderColor: 'rgba(255, 77, 79, 1)', fill: true }
                    ]
                },
                options: chartOptions
            })
        ];
    }

    // 时间范围更新函数
    function updateTimeRange(value) {
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const today = moment('2025-03-07');

        // 移除所有按钮的 active 状态
        document.querySelectorAll('.charts-section .time-btn').forEach(btn => btn.classList.remove('active'));
        const activeBtn = document.querySelectorAll(`.charts-section .time-btn[data-range="${value}"]`);
        if (activeBtn) activeBtn.forEach(item =>{
            item.classList.add('active')
        });

        if (value === 'custom') {
            startDateInput.style.display = 'inline-block';
            endDateInput.style.display = 'inline-block';
        } else {
            startDateInput.style.display = 'none';
            endDateInput.style.display = 'none';
            const days = parseInt(value);
            const endDate = today;
            const startDate = today.clone().subtract(days - 1, 'days');
            startDateInput.value = startDate.format('YYYY-MM-DD');
            endDateInput.value = endDate.format('YYYY-MM-DD');
            updateCharts(startDate, endDate);
        }
    }

    // 更新图表
    function updateCharts(startDate, endDate) {
        const days = endDate.diff(startDate, 'days') + 1;
        const newLabels = Array.from({ length: days }, (_, i) => startDate.clone().add(i, 'days').format('YYYY-MM-DD'));
        charts.forEach(chart => {
            chart.data.labels = newLabels;
            chart.data.datasets.forEach(dataset => {
                dataset.data = Array.from({ length: days }, () => Math.floor(Math.random() * 100));
            });
            chart.update();
        });
    }

    // 自定义时间范围更新
    function updateCustomRange() {
        const startDate = moment(document.getElementById('startDate').value);
        const endDate = moment(document.getElementById('endDate').value);
        if (startDate.isValid() && endDate.isValid() && startDate <= endDate) {
            document.getElementById('timeRangeSelect').value = 'custom';
            updateCharts(startDate, endDate);
        }
    }

    // 切换自定义时间范围（趋势统计）
    function toggleCustomRange() {
        updateTimeRange('custom');
    }

    function toggleHotCustomRange() {
        updateHotSection('custom');
    }

    // 初始化时默认选中“最近1周”和“今天”
    window.onload = () => {
        console.log('Page loaded, initializing...');
        w3.includeHTML(() => {
            console.log('External HTML included');
            initMenus();
            generateDashboardStats();
            generateHotStats();
            initCharts();
            updateTimeRange('7');  // 默认选中“最近1周”
            updateHotSection('today');  // 默认选中“今天”
        });
    };
</script>
</body>
</html>