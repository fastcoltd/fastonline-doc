<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FASTRESP - 系统大盘</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/antd/4.24.14/antd.min.css" integrity="sha512-Kc2RX0r68yS5yJTuJLUW9RZ56XA8yXvQHIV7R25bHv35XGLQTSVqSAtcfmGrbXkuuKOlOEMA4iO2k2z7E5OuMSQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="_style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.43/moment-timezone-with-data.min.js"></script>
    <script src="https://www.w3schools.com/lib/w3.js"></script>
    <script src="_common.js"></script>
</head>
<body>
<div class="container">
    <!-- 顶部 -->
    <div id="header" w3-include-html="_header.html"></div>

    <!-- 内容区域 -->
    <div class="content-wrapper">
        <!-- 侧边栏 -->
        <div id="sidebar" w3-include-html="_sidebar.html"></div>

        <!-- 主内容区域 -->
        <div class="main-content">
            <h2 style="font-size: 20px; margin-bottom: 24px;">单项统计</h2>
            <div class="dashboard-grid">
                <div class="card"><div class="card-title">用户总数 (user)</div><div class="card-content">1,234</div><div class="card-subtext">昨日新增: 15</div><button class="ant-btn ant-btn-primary" onclick="window.location.href='user_info.html'">查看详情</button></div>
                <div class="card"><div class="card-title">订单总数 (orders)</div><div class="card-content">567</div><div class="card-subtext">待处理: 45</div><button class="ant-btn ant-btn-primary" onclick="window.location.href='order_info.html'">查看详情</button></div>
                <div class="card"><div class="card-title">店铺销售额 (store_stat)</div><div class="card-content">¥12,345</div><div class="card-subtext">店铺总数: 78</div><button class="ant-btn ant-btn-primary" onclick="window.location.href='store_stat_overview.html'">查看详情</button></div>
                <div class="card"><div class="card-title">今日排班 (schedule)</div><div class="card-content">8</div><div class="card-subtext">已签到: 6</div><button class="ant-btn ant-btn-primary" onclick="window.location.href='schedule_plan.html'">查看详情</button></div>
                <div class="card"><div class="card-title">工单记录 (order_ticket)</div><div class="card-content">45</div><div class="card-subtext">待处理: 15</div><button class="ant-btn ant-btn-primary" onclick="window.location.href='ticket_record.html'">查看详情</button></div>
                <div class="card"><div class="card-title">订单退款申请 (orders_refunds)</div><div class="card-content">22</div><div class="card-subtext">待审核: 10</div><button class="ant-btn ant-btn-primary" onclick="window.location.href='refund_management.html'">查看详情</button></div>
                <div class="card"><div class="card-title">订单换货申请 (orders_replacements)</div><div class="card-content">18</div><div class="card-subtext">待处理: 8</div><button class="ant-btn ant-btn-primary" onclick="window.location.href='replacement_management.html'">查看详情</button></div>
                <div class="card"><div class="card-title">客户投诉 (complaint)</div><div class="card-content">15</div><div class="card-subtext">待解决: 7</div><button class="ant-btn ant-btn-primary" onclick="window.location.href='complaint_record.html'">查看详情</button></div>
                <div class="card"><div class="card-title">用户KYC审核 (user_kyc)</div><div class="card-content">50</div><div class="card-subtext">待审核: 20</div><button class="ant-btn ant-btn-primary" onclick="window.location.href='kyc_verification.html'">查看详情</button></div>
                <div class="card"><div class="card-title">商品审核 (item)</div><div class="card-content">120</div><div class="card-subtext">待审核: 35</div><button class="ant-btn ant-btn-primary" onclick="window.location.href='item_info.html'">查看详情</button></div>
                <div class="card"><div class="card-title">店铺审核 (store)</div><div class="card-content">78</div><div class="card-subtext">待审核: 12</div><button class="ant-btn ant-btn-primary" onclick="window.location.href='store_info.html'">查看详情</button></div>
                <div class="card"><div class="card-title">店铺FAQ审核 (store_faq)</div><div class="card-content">25</div><div class="card-subtext">待审核: 8</div><button class="ant-btn ant-btn-primary" onclick="window.location.href='store_faq.html'">查看详情</button></div>
                <div class="card"><div class="card-title">博客审核 (user_blog)</div><div class="card-content">40</div><div class="card-subtext">待审核: 15</div><button class="ant-btn ant-btn-primary" onclick="window.location.href='blog_management.html'">查看详情</button></div>
                <div class="card"><div class="card-title">博客文章审核 (posts)</div><div class="card-content">60</div><div class="card-subtext">待审核: 18</div><button class="ant-btn ant-btn-primary" onclick="window.location.href='article_management.html'">查看详情</button></div>
            </div>

            <!-- 趋势统计 -->
            <div class="charts-section">
                <h2 style="font-size: 20px; margin-bottom: 24px;">趋势统计</h2>
                <div class="time-filter">
                    <select class="ant-select" id="timeRangeSelect" onchange="updateTimeRange(this.value)">
                        <option value="7">最近1周</option>
                        <option value="30">最近30天</option>
                        <option value="60">最近60天</option>
                        <option value="90">最近90天</option>
                        <option value="custom">自定义</option>
                    </select>
                    <input type="date" class="ant-input" id="startDate" onchange="updateCustomRange()" value="2025-02-23">
                    <input type="date" class="ant-input" id="endDate" onchange="updateCustomRange()" value="2025-03-01">
                </div>
                <div class="brand-service-filter">
                    <select class="ant-select" id="brandSelect">
                        <option value="">全部品牌</option>
                        <option value="apple">苹果</option>
                        <option value="google">谷歌</option>
                        <option value="microsoft">微软</option>
                        <option value="yahoo">雅虎</option>
                        <option value="tiktok">TikTok</option>
                        <option value="facebook">Facebook</option>
                    </select>
                    <select class="ant-select" id="serviceSelect">
                        <option value="">全部服务</option>
                        <option value="account">账号</option>
                        <option value="pointcard">点卡</option>
                        <option value="equipment">装备</option>
                        <option value="article">软文</option>
                        <option value="software">软件</option>
                        <option value="membership">会员</option>
                        <option value="giftcard">礼品卡</option>
                        <option value="virtualgoods">虚拟商品</option>
                        <option value="advertising">广告</option>
                        <option value="consulting">咨询</option>
                        <option value="training">培训</option>
                        <option value="data">数据服务</option>
                    </select>
                </div>
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-title">充值额/销售额/退款额</div>
                        <canvas id="salesMoneyChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">平均购买件数/客单价</div>
                        <canvas id="salesAvgChart"></canvas>
                    </div>
                </div>
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-title">订单数/售后数/退款订单数/工单数</div>
                        <canvas id="salesCountChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">用户平均订单数/购买数</div>
                        <canvas id="userAvgChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- 基础统计 -->
            <div class="charts-section">
                <h2 style="font-size: 20px; margin-bottom: 24px;">基础统计</h2>
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-title">新增店铺数/商品数</div>
                        <canvas id="basicStoreChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">用户注册/KYC/店铺/黑名单</div>
                        <canvas id="basicUserChart"></canvas>
                    </div>
                </div>
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-title">新增文章/博客数量</div>
                        <canvas id="basicContentChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- 投诉统计 -->
            <div class="charts-section">
                <h2 style="font-size: 20px; margin-bottom: 24px;">投诉统计</h2>
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-title">投诉数</div>
                        <canvas id="complaintChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部 -->
    <div id="footer" w3-include-html="_footer.html"></div>
</div>

<script>
    // 全局变量
    const timeRanges = { 7: 7, 30: 30, 60: 60, 90: 90 };
    let labels = Array.from({ length: 7 }, (_, i) => moment('2025-03-01').subtract(6 - i, 'days').format('YYYY-MM-DD'));
    const chartOptions = {
        responsive: true,
        maintainAspectRatio: true,
        plugins: { legend: { position: 'bottom' } },
        scales: { y: { beginAtZero: true } }
    };

    // 图表初始化
    const charts = [
        new Chart(document.getElementById('salesMoneyChart'), {
            type: 'line', data: {
                labels, datasets: [
                    { label: '充值额', data: [100, 120, 150, 130, 140, 160, 180], backgroundColor: 'rgba(249, 115, 22, 0.3)', borderColor: 'rgba(249, 115, 22, 1)', fill: true },
                    { label: '销售额', data: [200, 220, 250, 230, 240, 260, 280], backgroundColor: 'rgba(30, 58, 138, 0.3)', borderColor: 'rgba(30, 58, 138, 1)', fill: true },
                    { label: '退款额', data: [20, 25, 30, 28, 25, 30, 35], backgroundColor: 'rgba(255, 77, 79, 0.3)', borderColor: 'rgba(255, 77, 79, 1)', fill: true }
                ]
            }, options: chartOptions
        }),
        new Chart(document.getElementById('salesAvgChart'), {
            type: 'line', data: {
                labels, datasets: [
                    { label: '平均购买件数', data: [5, 6, 5, 7, 6, 8, 7], backgroundColor: 'rgba(255, 215, 0, 0.3)', borderColor: 'rgba(255, 215, 0, 1)', fill: true },
                    { label: '客单价', data: [50, 55, 60, 58, 62, 65, 70], backgroundColor: 'rgba(249, 115, 22, 0.3)', borderColor: 'rgba(249, 115, 22, 1)', fill: true }
                ]
            }, options: chartOptions
        }),
        new Chart(document.getElementById('salesCountChart'), {
            type: 'line', data: {
                labels, datasets: [
                    { label: '订单数', data: [30, 35, 40, 38, 42, 45, 50], backgroundColor: 'rgba(249, 115, 22, 0.3)', borderColor: 'rgba(249, 115, 22, 1)', fill: true },
                    { label: '售后数', data: [5, 6, 7, 8, 6, 7, 9], backgroundColor: 'rgba(30, 58, 138, 0.3)', borderColor: 'rgba(30, 58, 138, 1)', fill: true },
                    { label: '退款订单数', data: [3, 4, 5, 4, 5, 6, 7], backgroundColor: 'rgba(255, 77, 79, 0.3)', borderColor: 'rgba(255, 77, 79, 1)', fill: true },
                    { label: '工单数', data: [10, 12, 15, 14, 13, 16, 18], backgroundColor: 'rgba(255, 215, 0, 0.3)', borderColor: 'rgba(255, 215, 0, 1)', fill: true }
                ]
            }, options: chartOptions
        }),
        new Chart(document.getElementById('userAvgChart'), {
            type: 'line', data: {
                labels, datasets: [
                    { label: '用户平均订单数', data: [2.5, 2.8, 3.0, 2.9, 3.2, 3.5, 3.7], backgroundColor: 'rgba(249, 115, 22, 0.3)', borderColor: 'rgba(249, 115, 22, 1)', fill: true },
                    { label: '用户平均购买数', data: [10, 12, 15, 14, 16, 18, 20], backgroundColor: 'rgba(30, 58, 138, 0.3)', borderColor: 'rgba(30, 58, 138, 1)', fill: true }
                ]
            }, options: chartOptions
        }),
        new Chart(document.getElementById('basicStoreChart'), {
            type: 'line', data: {
                labels, datasets: [
                    { label: '新增店铺数', data: [5, 6, 7, 8, 6, 9, 10], backgroundColor: 'rgba(249, 115, 22, 0.3)', borderColor: 'rgba(249, 115, 22, 1)', fill: true },
                    { label: '新增商品数', data: [20, 25, 30, 28, 32, 35, 40], backgroundColor: 'rgba(30, 58, 138, 0.3)', borderColor: 'rgba(30, 58, 138, 1)', fill: true }
                ]
            }, options: chartOptions
        }),
        new Chart(document.getElementById('basicUserChart'), {
            type: 'line', data: {
                labels, datasets: [
                    { label: '用户注册', data: [50, 55, 60, 58, 62, 65, 70], backgroundColor: 'rgba(249, 115, 22, 0.3)', borderColor: 'rgba(249, 115, 22, 1)', fill: true },
                    { label: 'KYC', data: [10, 12, 15, 14, 13, 16, 18], backgroundColor: 'rgba(30, 58, 138, 0.3)', borderColor: 'rgba(30, 58, 138, 1)', fill: true },
                    { label: '新增店铺数', data: [5, 6, 7, 8, 6, 9, 10], backgroundColor: 'rgba(255, 77, 79, 0.3)', borderColor: 'rgba(255, 77, 79, 1)', fill: true },
                    { label: '黑名单', data: [2, 3, 4, 3, 5, 4, 6], backgroundColor: 'rgba(255, 215, 0, 0.3)', borderColor: 'rgba(255, 215, 0, 1)', fill: true }
                ]
            }, options: chartOptions
        }),
        new Chart(document.getElementById('basicContentChart'), {
            type: 'line', data: {
                labels, datasets: [
                    { label: '新增文章数量', data: [15, 18, 20, 22, 19, 23, 25], backgroundColor: 'rgba(249, 115, 22, 0.3)', borderColor: 'rgba(249, 115, 22, 1)', fill: true },
                    { label: '新增博客数量', data: [3, 4, 5, 6, 4, 7, 8], backgroundColor: 'rgba(30, 58, 138, 0.3)', borderColor: 'rgba(30, 58, 138, 1)', fill: true }
                ]
            }, options: chartOptions
        }),
        new Chart(document.getElementById('complaintChart'), {
            type: 'line', data: {
                labels, datasets: [
                    { label: '投诉总数', data: [15, 17, 20, 18, 19, 22, 25], backgroundColor: 'rgba(255, 77, 79, 0.3)', borderColor: 'rgba(255, 77, 79, 1)', fill: true }
                ]
            }, options: chartOptions
        })
    ];

    // 时间范围更新函数
    function updateTimeRange(value) {
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const today = moment('2025-03-01');
        if (value === 'custom') {
            startDateInput.style.display = 'inline-block';
            endDateInput.style.display = 'inline-block';
        } else {
            const days = parseInt(value);
            const endDate = today;
            const startDate = today.clone().subtract(days - 1, 'days');
            startDateInput.value = startDate.format('YYYY-MM-DD');
            endDateInput.value = endDate.format('YYYY-MM-DD');
            updateCharts(startDate, endDate);
        }
    }

    // 更新图表
    function updateCharts(startDate, endDate) {
        const days = endDate.diff(startDate, 'days') + 1;
        const newLabels = Array.from({ length: days }, (_, i) => startDate.clone().add(i, 'days').format('YYYY-MM-DD'));
        charts.forEach(chart => {
            chart.data.labels = newLabels;
            chart.data.datasets.forEach(dataset => {
                dataset.data = Array.from({ length: days }, () => Math.floor(Math.random() * 100));
            });
            chart.update();
        });
    }

    // 自定义时间范围更新
    function updateCustomRange() {
        const startDate = moment(document.getElementById('startDate').value);
        const endDate = moment(document.getElementById('endDate').value);
        if (startDate.isValid() && endDate.isValid() && startDate <= endDate) {
            document.getElementById('timeRangeSelect').value = 'custom';
            updateCharts(startDate, endDate);
        }
    }

    // 初始化
    window.onload = () => {
        console.log('Page loaded, initializing...');
        w3.includeHTML(() => {
            console.log('External HTML included');
            initMenus();
            updateTimeRange('7'); // 初始化最近1周
        });
    };
</script>
</body>
</html>