<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>店铺详情 - FASTRESP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/antd/4.24.10/antd.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="_style.css">
    <link rel="stylesheet" href="_site.css">
    <style>
        body { padding-top: 7.4em !important; transition: padding-top 0.3s ease; }
        .container { max-width: var(--max-content-width); margin: -8em auto 0 auto; position: relative; padding-top: 8em; }

        /* 店铺信息头部 */
        .store-header { position: sticky; top: 0; background: var(--bg-white); z-index: 10; padding: 1em; border-bottom: 0.0625em solid var(--border-color); transition: all 0.3s ease; }
        .store-header.fixed { position: fixed; width: 100%; top: 0; left: 0; right: 0; box-shadow: 0 0.125em 0.3125em rgba(0, 0, 0, 0.1); padding: 0.5em; }
        .store-inner { display: flex; gap: 1em; max-width: var(--max-content-width); margin: 0 auto; }
        .store-left { flex: 75%; }
        .store-right { flex: 25%; }
        .store-basic { display: flex; align-items: center; gap: 1em; }
        .store-logo img { width: 4em; height: 4em; border-radius: 50%; }
        .store-info h1 { font-size: var(--font-xlarge); margin: 0; }
        .store-detail { margin-top: 0.5em; }
        .store-group { display: flex; align-items: center; gap: 1em; font-size: var(--font-medium); margin: 0.25em 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .store-group i { margin-right: 0.5em; }
        .store-summary { max-height: 2em; overflow: hidden; transition: max-height 0.8s ease; }
        .store-summary.expanded { max-height: none; }
        .toggle-summary { cursor: pointer; color: var(--natural-green); font-size: var(--font-small); margin-left: 0.5em; }
        .team-member { display: flex; align-items: center; gap: 0.5em; position: relative; }
        .team-member img { width: 2em; height: 2em; border-radius: 50%; }
        .online-dot { width: 0.5em; height: 0.5em; border-radius: 50%; position: absolute; right: 0; bottom: 0; }
        .store-services a { color: var(--font-orange); margin-right: 0.5em; }
        .tab-bar { display: none; padding: 0.5em 0; }
        .store-header.fixed .tab-bar { display: block; position: fixed; width: 100%; top: calc(3em + 0.0625em); left: 0; right: 0; background: var(--bg-white); }
        .store-header.fixed .store-right > *:not(.response-time) { display: none; }
        .store-header.fixed .store-left > *:not(.store-basic):not(.store-summary):not(.store-aftersales):not(.store-team) { display: none; }
        .tab-inner { max-width: var(--max-content-width); margin: 0 auto; display: flex; gap: 2em; }
        .attr-tab { cursor: pointer; font-size: var(--font-medium); padding-bottom: 0.2em; }
        .attr-tab.active { color: var(--natural-green); background: var(--bg-white); border-bottom: 2px solid var(--natural-green); font-weight: bold; }

        /* 右侧样式 */
        .response-time, .rating-overview h4, .rating-item { font-size: var(--font-medium); white-space: nowrap; gap:1em;margin: 0.25em 0; }
        .rating-bar { display: flex; align-items: center; gap: 0.5em; margin: 0.25em 0; }
        .rating-bar progress {height: 0.5em; }
        .store-charts { margin-top: 0.5em; }
        .chart-tabs { display: flex; gap: 1em; }
        .chart-tab { cursor: pointer; padding: 0.5em; }
        .chart-tab.active { border-bottom: 2px solid var(--natural-green); color: var(--natural-green); }
        .chart-container { height: 12em; }

        /* 商品筛选和列表 */
        .filter-bar { display: flex; gap: 1em; flex-wrap: wrap; padding: 1em; border: 0.0625em solid var(--border-color); border-radius: 0.5em; }
        .filter-item { cursor: pointer; padding: 0.5em 1em; border: 0.0625em solid var(--border-color); border-radius: 0.375em; }
        .filter-item.active { background: var(--natural-green); color: var(--font-white); }
        .filter-search { display: flex; gap: 0.5em; }

        /* FAQ 和评价 */
        .faq-item, .review-item { margin-bottom: 1em; padding: 1em; border: 0.0625em solid var(--border-color); border-radius: 0.5em; }
        .review-header { display: flex; align-items: center; gap: 0.5em; justify-content: space-between; }
        .review-user { display: flex; align-items: center; gap: 0.5em; }
        .review-user img { width: 2em; height: 2em; border-radius: 50%; }
        .review-sort select { padding: 0.3em; }
        .review-item hr { margin: 0.5em 0; }
        .review-reply { display: none; margin-top: 0.5em; }
        .review-reply.expanded { display: block; }
        .show-more { text-align: center; margin-top: 1em; }

        /* 移动端适配 */
        @media (max-width: 48em) {
            body { padding-top: 5em !important; }
            .store-inner { flex-direction: column; }
            .store-left, .store-right { flex: 100%; }
            .store-group { flex-wrap: wrap; }
            .chart-container { height: 10em; }
            .store-header.fixed .tab-bar { top: calc(2.5em + 0.0625em); }
        }
    </style>
</head>
<body>
<div w3-include-html="_header.html"></div>
<div class="container">
    <div class="store-header" id="store-header"></div>
    <div class="section" id="store-items">
        <div class="filter-bar" id="item-filter"></div>
        <div id="item-list" class="card-list"></div>
        <div class="pagination" id="item-pagination"></div>
    </div>
    <div class="section" id="store-faqs">
        <h3 class="section-title">店铺常见问题</h3>
        <div class="card-list"></div>
    </div>
    <div class="section" id="store-reviews">
        <h3 class="section-title">店铺评价</h3>
        <div class="card-list"></div>
        <div class="show-more"><button class="btn-solid-medium" onclick="loadMoreReviews()">显示更多评价</button></div>
    </div>
</div>
<div w3-include-html="_footer.html"></div>

<script src="https://www.w3schools.com/lib/w3.js"></script>
<script src="https://cdn.jsdelivr.net/npm/faker@5.5.3/dist/faker.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="_fields.js"></script>
<script src="_data.js"></script>
<script src="_location.js"></script>
<script src="_member.js"></script>
<script src="_common.js"></script>
<script>
    const urlParams = new URLSearchParams(window.location.search);
    const storeName = urlParams.get('name') || 'Demo Store';
    const storeData = generateData(storeFieldConfig, 1)[0];
    let currentPage = 1;
    const itemsPerPage = 10;
    let reviewPage = 1;
    let chartInstance;

    // 统一取值函数
    function getSampleValue(config, index = 0) {
        if (undefined == config){
            return '****'
        }
        return undefined != config.sample && typeof config.sample === 'function' ? config.sample(index) : config.value || 'N/A';
    }

    // 渲染店铺头部
    function renderStoreHeader() {
        const header = document.getElementById('store-header');
        const staffCount = randomInt(1, 3);
        const staffData = generateData(storeStaffFieldConfig, staffCount);
        const servicesData = services.slice(0, randomInt(3, 5));
        const aftersalesContent = Array(randomInt(2, 3)).fill().map(() => faker.lorem.sentence()).join('<br>');
        const deposit = randomInt(500, 5000);
        const tags = generateTag(1, 3);

        header.innerHTML = `
            <div class="store-inner">
                <div class="store-left">
                    <div class="store-basic">
                        <div class="store-logo"><img src="${getSampleValue(storeFieldConfig.image, 0)}" alt="${storeName}"></div>
                        <div class="store-info">
                            <h1>${storeName}</h1>
                            <p>${getSampleValue(storeFieldConfig.slogan)}</p>
                        </div>
                    </div>
                    <div class="store-detail">
                        <div class="store-group">
                            <span><i class="fas fa-map-marker-alt"></i> 位置: ${faker.address.country()}</span>
                            <span><i class="fas fa-clock"></i> 时区: GMT+${randomInt(0, 12)}</span>
                            <span><i class="fas fa-briefcase"></i> 工作时间: ${getSampleValue(storeFieldConfig.work_time)}</span>
                        </div>
                        <div class="store-group">
                            <span><i class="fas fa-language"></i> 语言: ${['中文', 'English', '日本語'].slice(0, randomInt(1, 3)).join(', ')}</span>
                            <span><i class="fas fa-user ${getSampleValue(storeFieldConfig.online_status) === '在线' ? 'text-success' : 'text-muted'}"></i> 在线状态: ${getSampleValue(storeFieldConfig.online_status)}</span>
                        </div>
                        <div class="store-group">
                            <span><i class="fas fa-shield-alt"></i> 保证金: $${deposit}</span>
                            <span><i class="fas fa-check-circle ${getSampleValue(storeFieldConfig.verified) === '已认证' ? 'text-success' : 'text-danger'}"></i> 认证状态: ${getSampleValue(storeFieldConfig.verified)}</span>
                            <span>${tags.map((tag, i) => `<span class="${tagColors[i % tagColors.length]}">${tag}</span>`).join(' ')}</span>
                        </div>
                    </div>
                    <div class="store-summary" id="store-summary">${getSampleValue(storeFieldConfig.summary)}</div>
                    <span class="toggle-summary" onclick="toggleSummary()">展开更多</span>
                    ${staffCount > 1 ? `
                        <div class="store-team">
                            <h4>团队信息</h4>
                            ${staffData.map((s, i) => `
                                <div class="team-member">
                                    <img src="${getSampleValue(storeStaffFieldConfig.avatar, i)}" alt="${getSampleValue(storeStaffFieldConfig.nick_name)}">
                                    <span>${getSampleValue(storeStaffFieldConfig.nick_name)} - ${getSampleValue(storeStaffFieldConfig.title)}</span>
                                    <span class="online-dot" style="background: ${getSampleValue(storeStaffFieldConfig.status) === '启用' ? '#32CD32' : '#A9A9A9'}"></span>
                                </div>
                            `).join('')}
                        </div>` : ''}
                    <div class="store-services">
                        <h4>服务</h4>
                        ${servicesData.map(s => `<a href="store.html?name=${storeName}&services=${s.name}">${s.name}</a>`).join('')}
                    </div>
                    <div class="store-aftersales">
                        <h4>售后规则</h4>
                        <p>${aftersalesContent.split('<br>')[0]} ... <span class="toggle-summary" onclick="showModal('aftersales-modal', '${aftersalesContent}', { className: 'aftersales-modal' })">展开更多</span></p>
                    </div>
                </div>
                <div class="store-right">
                    <div class="response-time">平均响应时间: ${randomInt(1, 5)}小时 (${new Date().toLocaleTimeString('zh-CN', { timeZone: 'Asia/Shanghai', hour: '2-digit', minute: '2-digit' })} 本地时间)</div>
                    <div class="rating-overview">
                        <div class="rating-item">
                            <span>总评分: ${getSampleValue(storeFieldConfig.rating)} (${getSampleValue(storeFieldConfig.rating)})</span>
                            <span>服务: ${faker.datatype.float({ min: 4, max: 5, precision: 0.1 })}</span>
                            <span>物流: ${faker.datatype.float({ min: 4, max: 5, precision: 0.1 })}</span>
                            <span>商品: ${faker.datatype.float({ min: 4, max: 5, precision: 0.1 })}</span>
                        </div>
                        ${[5, 4, 3, 2, 1].map(i => {
            const count = faker.datatype.number({ min: 10, max: 100 });
            return `<div class="rating-bar">${i}星 <progress value="${count}" max="100"></progress> ${count}</div>`;
        }).join('')}
                    </div>
                    <div class="store-charts">
                        <div class="chart-tabs">
                            <span class="chart-tab" data-days="7" onclick="renderChart(7)">7天</span>
                            <span class="chart-tab" data-days="14" onclick="renderChart(14)">14天</span>
                            <span class="chart-tab active" data-days="30" onclick="renderChart(30)">30天</span>
                        </div>
                        <canvas id="store-chart" class="chart-container"></canvas>
                    </div>
                </div>
            </div>
            <div class="tab-bar">
                <div class="tab-inner">
                    <span class="attr-tab" data-section="store-items" onclick="scrollToSection('store-items')">商品</span>
                    <span class="attr-tab" data-section="store-faqs" onclick="scrollToSection('store-faqs')">常见问题</span>
                    <span class="attr-tab" data-section="store-reviews" onclick="scrollToSection('store-reviews')">评价</span>
                </div>
            </div>
        `;
        renderChart(30);
    }

    // 渲染图表
    function renderChart(days) {
        const ctx = document.getElementById('store-chart').getContext('2d');
        const labels = Array(days).fill().map((_, i) => `${days - i}天前`);
        const data = {
            labels,
            datasets: [
                { label: '好评率', data: Array(days).fill().map(() => getSampleValue(storeFieldConfig.rating) / 5 * 100), borderColor: '#32CD32' },
                { label: '响应率', data: Array(days).fill().map(() => faker.datatype.float({ min: 70, max: 100 })), borderColor: '#4682B4' },
                { label: '供货充足率', data: Array(days).fill().map(() => Math.min(100, getSampleValue(storeFieldConfig.stock_quantity) / getSampleValue(storeFieldConfig.sales) * 100)), borderColor: '#FFD700' },
                { label: '销售量', data: Array(days).fill().map(() => getSampleValue(storeFieldConfig.sales)), borderColor: '#FF4500' },
            ]
        };
        if (chartInstance) chartInstance.destroy();
        chartInstance = new Chart(ctx, {
            type: 'line',
            data,
            options: { scales: { y: { beginAtZero: true } } }
        });
        document.querySelectorAll('.chart-tab').forEach(tab => tab.classList.remove('active'));
        document.querySelector(`.chart-tab[data-days="${days}"]`).classList.add('active');
    }

    // 渲染商品筛选和列表
    function renderStoreItems() {
        const filter = document.getElementById('item-filter');
        const brands = hotBrands.slice(0, randomInt(3, 5));
        const tags = generateTag(3, 5);
        filter.innerHTML = `
            ${brands.map(b => `<div class="filter-item" data-brand="${b.name}" style="color: ${b.themeColor}" brandColor="${b.themeColor}" onclick="toggleFilter(this, 'brand')">${b.name}</div>`).join('')}
            ${tags.map((t, i) => `<div class="filter-item ${tagColors[i % tagColors.length]}" data-tag="${t}" onclick="toggleFilter(this, 'tag')">${t}</div>`).join('')}
            <div class="filter-search">
                <input type="text" id="search-item" placeholder="搜索商品">
                <button class="btn-solid-medium" onclick="applyItemFilter()">搜索</button>
            </div>
        `;
        applyItemFilter();
    }

    function toggleFilter(element, type) {
        if (type === 'brand') {
            document.querySelectorAll('.filter-item[data-brand]').forEach(el => {
                el.style.background = '';
                el.style.color = el.getAttribute('brandColor');
                el.classList.remove('active')

            });
            element.classList.add('active');
            let color = element.getAttribute('brandColor');
            let background = element.style.background ?? 'var(--font-white)';
            element.style = `background:${color}; color:${background}`
        } else {
            element.classList.toggle('active');
        }
        applyItemFilter();
    }

    function applyItemFilter() {
        const selectedBrand = document.querySelector('.filter-item[data-brand].active')?.dataset.brand || '';
        const selectedTags = Array.from(document.querySelectorAll('.filter-item[data-tag].active')).map(el => el.dataset.tag);
        const searchText = document.getElementById('search-item').value.toLowerCase();
        const items = generateData(itemFieldConfig, randomInt(8, 60)).filter(item => {
            return (!selectedBrand || getSampleValue(itemFieldConfig.brandName).includes(selectedBrand)) &&

                (!selectedTags.length || selectedTags.every(t => getSampleValue(itemFieldConfig.tags).includes(t))) &&
                (!searchText || getSampleValue(itemFieldConfig.name).toLowerCase().includes(searchText));
        });
        const totalPages = Math.ceil(items.length / itemsPerPage);
        const start = (currentPage - 1) * itemsPerPage;
        generateCards('item-list', 'card', items.slice(start, start + itemsPerPage), itemFieldConfig);

        let title = `店铺 - ${storeName}`;
        if (selectedBrand) title += ` - ${selectedBrand}`;
        if (selectedTags.length) title += ` - ${selectedTags.join(' ')}`;
        document.title = `${title} - FASTRESP`;

        const pagination = document.getElementById('item-pagination');
        pagination.innerHTML = `
            ${currentPage > 1 ? `<button class="ant-btn pagination-btn" onclick="changeItemPage(-1)">上一页</button>` : ''}
            <span>${currentPage} / ${totalPages}</span>
            ${currentPage < totalPages ? `<button class="ant-btn pagination-btn" onclick="changeItemPage(1)">下一页</button>` : ''}
        `;
        history.pushState({}, title, `store.html?name=${storeName}${selectedBrand ? `&brand=${selectedBrand}` : ''}${selectedTags.length ? `&tags=${selectedTags.join(',')}` : ''}${searchText ? `&q=${searchText}` : ''}`);
    }

    function changeItemPage(delta) {
        currentPage += delta;
        applyItemFilter();
    }

    // 渲染店铺 FAQ
    function renderStoreFaqs() {
        const faqs = generateData(storeFaqFieldConfig, randomInt(3, 6));
        const container = document.querySelector('#store-faqs .card-list');
        faqs.forEach((faq, index) => {
            const faqItem = document.createElement('div');
            faqItem.className = 'faq-item';
            faqItem.innerHTML = `
                <div class="faq-question" onclick="toggleAnswer(this)">
                    <span class="faq-question-text">${getSampleValue(storeFaqFieldConfig.question)}</span>
                    <span><i class="fas fa-chevron-down faq-toggle"></i><i class="fas fa-chevron-up faq-toggle"></i></span>
                </div>
                <div class="faq-answer">${getSampleValue(storeFaqFieldConfig.answer)}</div>
            `;
            container.appendChild(faqItem);
        });
    }

    // 渲染店铺评价
    let reviews = [];
    function renderStoreReviews() {
        if (!reviews.length) reviews = generateData(ordersCommentFieldConfig, randomInt(50, 500));
        const container = document.querySelector('#store-reviews .card-list');
        container.innerHTML = `
            <div class="review-header">
                <span>1-10 / ${reviews.length} 条评价</span>
                <div class="review-sort">
                    <select class="ant-select" onchange="sortReviews(this.value)">
                        <option value="time">按最近时间</option>
                        <option value="amount">按订单金额降序</option>
                    </select>
                </div>
            </div>
        `;
        reviews.slice(0, 10).forEach((review, index) => {
            const reviewItem = document.createElement('div');
            reviewItem.className = 'review-item';
            reviewItem.innerHTML = `
                <div class="review-user">
                    <img src="${getSampleValue(ordersCommentFieldConfig.image, index)}" alt="User">
                    <span>${faker.address.country()}</span>
                    <span>${faker.name.findName()}</span>
                    ${Math.random() > 0.5 ? '<span class="text-success"><i class="fas fa-user-check"></i> 回头客</span>' : ''}
                </div>
                <hr>
                <div class="rating-wrapper">${generateRating(review, getSampleValue(ordersCommentFieldConfig.rating))}</div>
                <p>${Math.floor(Math.random() * 365)}天前</p>
                <p>${faker.lorem.sentences(randomInt(2, 3))}</p>
                <p>商品: <img src="${getSampleValue(ordersCommentFieldConfig.image, index)}" alt="${getSampleValue(ordersCommentFieldConfig.itemName)}" style="width: 2em; height: 2em;"> ${getSampleValue(ordersCommentFieldConfig.itemName)} - 数量: ${faker.datatype.number({ min: 1, max: 5 })} - 价格: ${getSampleValue(ordersCommentFieldConfig.price)} - ${Math.floor(Math.random() * 365)}天前</p>
                <p><img src="${getSampleValue(storeFieldConfig.image, 0)}" alt="${storeName}" style="width: 1.5em; height: 1.5em;"> ${storeName} <i class="fas fa-chevron-down" onclick="toggleReply(this)"></i></p>
                <div class="review-reply">${faker.lorem.sentence()}</div>
                <p>有用吗?
                    <span><i class="fas fa-thumbs-up" onclick="voteReview(this, 'yes', ${index})"></i> 是</span>
                    <span><i class="fas fa-thumbs-down" onclick="voteReview(this, 'no', ${index})"></i> 否</span>
                </p>
            `;
            container.appendChild(reviewItem);
        });
    }

    function sortReviews(type) {
        if (type === 'time') {
            reviews.sort(() => 0); // 示例，实际应基于时间字段
        } else {
            reviews.sort((a, b) => parseFloat(getSampleValue(ordersCommentFieldConfig.price, 1)) - parseFloat(getSampleValue(ordersCommentFieldConfig.price, 0)));
        }
        renderStoreReviews();
    }

    function toggleAnswer(element) {
        element.closest('.faq-item').classList.toggle('expanded');
    }

    function toggleReply(element) {
        const reply = element.closest('.review-item').querySelector('.review-reply');
        reply.classList.toggle('expanded');
        element.classList.toggle('fa-chevron-down');
        element.classList.toggle('fa-chevron-up');
    }

    function voteReview(element, type, index) {
        element.classList.toggle(type === 'yes' ? 'text-success' : 'text-danger');
    }

    function loadMoreReviews() {
        reviewPage++;
        const start = (reviewPage - 1) * 10;
        const newReviews = reviews.slice(start, start + 10);
        const container = document.querySelector('#store-reviews .card-list');
        newReviews.forEach((review, index) => {
            const reviewItem = document.createElement('div');
            reviewItem.className = 'review-item';
            reviewItem.innerHTML = `
                <div class="review-user">
                    <img src="${getSampleValue(ordersCommentFieldConfig.image, start + index)}" alt="User">
                    <span>${faker.address.country()}</span>
                    <span>${faker.name.findName()}</span>
                    ${Math.random() > 0.5 ? '<span class="text-success"><i class="fas fa-user-check"></i> 回头客</span>' : ''}
                </div>
                <hr>
                <div class="rating-wrapper">${generateRating(review, getSampleValue(ordersCommentFieldConfig.rating))}</div>
                <p>${Math.floor(Math.random() * 365)}天前</p>
                <p>${faker.lorem.sentences(randomInt(2, 3))}</p>
                <p>商品: <img src="${getSampleValue(ordersCommentFieldConfig.image, start + index)}" alt="${getSampleValue(ordersCommentFieldConfig.itemName)}" style="width: 2em; height: 2em;"> ${getSampleValue(ordersCommentFieldConfig.itemName)} - 数量: ${faker.datatype.number({ min: 1, max: 5 })} - 价格: ${getSampleValue(ordersCommentFieldConfig.price)} - ${Math.floor(Math.random() * 365)}天前</p>
                <p><img src="${getSampleValue(storeFieldConfig.image, 0)}" alt="${storeName}" style="width: 1.5em; height: 1.5em;"> ${storeName} <i class="fas fa-chevron-down" onclick="toggleReply(this)"></i></p>
                <div class="review-reply">${faker.lorem.sentence()}</div>
                <p>有用吗?
                    <span><i class="fas fa-thumbs-up" onclick="voteReview(this, 'yes', ${start + index})"></i> 是</span>
                    <span><i class="fas fa-thumbs-down" onclick="voteReview(this, 'no', ${start + index})"></i> 否</span>
                </p>
            `;
            container.appendChild(reviewItem);
        });
    }

    function toggleSummary() {
        const summary = document.getElementById('store-summary');
        summary.classList.toggle('expanded');
        summary.nextElementSibling.textContent = summary.classList.contains('expanded') ? '收起' : '展开更多';
    }

    function scrollToSection(sectionId) {
        const section = document.getElementById(sectionId);
        if (section) {
            const header = document.getElementById('store-header');
            const headerHeight = header.offsetHeight;
            const topHeader = document.querySelector('.header');
            const topHeaderHeight = window.scrollY > 0 ? 0 : topHeader.offsetHeight;
            const offsetTop = section.getBoundingClientRect().top + window.scrollY - (headerHeight + topHeaderHeight + 70);
            window.scrollTo({ top: offsetTop, behavior: 'smooth' });
            updateActiveTab(sectionId);
        }
    }

    function updateActiveTab(sectionId) {
        document.querySelectorAll('.attr-tab').forEach(tab => tab.classList.remove('active'));
        document.querySelector(`.attr-tab[data-section="${sectionId}"]`).classList.add('active');
    }

    function updateActiveTabOnScroll() {
        const sections = document.querySelectorAll('.section');
        const headerHeight = document.getElementById('store-header').offsetHeight;
        const scrollPosition = window.scrollY + headerHeight + 70;
        let activeSectionId = null;
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionBottom = sectionTop + section.offsetHeight;
            if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
                activeSectionId = section.id;
            }
        });
        if (activeSectionId) updateActiveTab(activeSectionId);
    }

    window.onload = () => {
        w3.includeHTML(() => {
            const header = document.getElementById('store-header');
            const initialHeight = header.offsetHeight;
            header.style.minHeight = `${initialHeight}px`;

            renderStoreHeader();
            renderStoreItems();
            renderStoreFaqs();
            renderStoreReviews();

            window.addEventListener('scroll', () => {
                const scrollY = window.scrollY;
                const topHeader = document.querySelector('.header');
                if (scrollY >= initialHeight) {
                    header.classList.add('fixed');
                    topHeader.classList.add('hidden');
                    document.body.style.paddingTop = `${initialHeight}px`;
                } else {
                    header.classList.remove('fixed');
                    topHeader.classList.remove('hidden');
                    document.body.style.paddingTop = '7.4em';
                }
                updateActiveTabOnScroll();
            });
        });
    };
</script>
</body>
</html>