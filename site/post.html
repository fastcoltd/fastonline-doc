<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>文章详情 - FASTRESP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/antd/4.24.10/antd.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="_style.css">
    <link rel="stylesheet" href="_site.css">
    <style>
        html { overflow: auto !important; height: auto; }
        body { padding-top: 7.4em !important; height: auto; overflow: auto !important; transition: padding-top 0.3s ease; }
        .container { max-width: var(--max-content-width); margin: -8em auto 0 auto; position: relative; padding-top: 8em; min-height: 200vh; }
        .post-header { max-width: var(--max-content-width); margin: 0 auto; display: flex; flex-direction: column; padding: 0.5em; border-bottom: 0.0625em solid var(--border-color); position: sticky; top: 0; background: var(--bg-white); z-index: 10; transition: box-shadow 0.3s ease; }
        .post-header.fixed { max-width: none; position: fixed; width: 100%; top: 0; z-index: 20; border-bottom: 0.0625em solid var(--border-color); left: 0; right: 0; padding: 0; box-shadow: 0 0.125em 0.3125em rgba(0, 0, 0, 0.1); }
        .post-inner { display: flex; align-items: center; width: 100%; }
        .post-header.fixed .post-inner { max-width: var(--max-content-width); margin: 0 auto; padding: 0.5em; }
        .post-info h1 { font-size: var(--font-xxlarge); margin: 0 0 0.5em; }
        .post-meta { display: flex; align-items: center; gap: 1em; flex-wrap: wrap; margin-bottom: 0.5em; }
        .author { display: flex; align-items: center; gap: 0.5em; }
        .author img { width: 2em; height: 2em; border-radius: 50%; }
        .store { display: flex; align-items: center; gap: 0.5em; }
        .store img { width: 1.5em; height: 1.5em; border-radius: 50%; }
        .category { color: var(--font-green); }
        .brands { display: flex; gap: 0.5em; flex-wrap: wrap; }
        .brand-item { display: flex; align-items: center; gap: 0.5em; }
        .brand-item img { width: 1.5em; height: 1.5em; border-radius: 50%; }
        .tags { display: flex; gap: 0.5em; flex-wrap: wrap; }
        .rating-wrapper { display: flex; align-items: center; gap: 0.5em; }
        .favorite-wrapper { position: absolute; right: 1em; top: 1em; display: flex; align-items: center; gap: 0.5em; }
        .stats { display: flex; gap: 1em; color: var(--text-secondary); }

        .post-content { padding: 1em 0; font-size: var(--font-medium); line-height: 1.8; background: var(--bg-white); transition: background 0.3s; }
        .post-content img { max-width: 100%; cursor: pointer; }
        .paid-section { filter: blur(5px); position: relative; }
        .paid-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; color: #fff; font-size: var(--font-large); cursor: pointer; }
        .theme-toggle { position: fixed; top: 50%; right: 1em; z-index: 100; background: var(--bg-white); border: 0.0625em solid var(--border-color); border-radius: 50%; padding: 0.5em; cursor: pointer; }
        .sidebar { position: fixed; top: 10em; right: 1em; width: 15em; background: var(--bg-white); border: 0.0625em solid var(--border-color); border-radius: 0.5em; padding: 1em; z-index: 90; max-height: 80vh; overflow-y: auto; }
        .sidebar a { display: block; margin: 0.5em 0; color: var(--text-primary); }
        .sidebar a:hover { color: var(--natural-green); }
        .share-section { margin: 1em 0; display: flex; gap: 1em; }
        .share-section img { width: 2em; height: 2em; cursor: pointer; }
        .comments-section { margin: 1em 0; }
        .comment-list { max-height: 20em; overflow-y: auto; }
        .comment-item { display: flex; gap: 1em; padding: 0.5em 0; border-bottom: 0.0625em solid var(--border-color); }
        .comment-item img { width: 2em; height: 2em; border-radius: 50%; }
        .comment-content { flex: 1; }
        .self-comment { margin-top: 1em; padding: 1em; background: var(--bg-light); border-radius: 0.5em; }
        .self-comment img { width: 2em; height: 2em; border-radius: 50%; }
        .self-comment textarea { width: 100%; padding: 0.5em; margin: 0.5em 0; }
        .captcha { display: flex; align-items: center; gap: 0.5em; margin: 0.5em 0; }
        .related-items .scroll-list { display: flex; flex-wrap: nowrap; overflow-x: auto; gap: 0.5em; }

        @media (max-width: 48em) {
            body { padding-top: 1.5em !important; margin: 0 !important; }
            .container { padding-top: 1.5em !important; margin: 0 !important; }
            .post-header { padding: 0.5em; }
            .post-info h1 { font-size: var(--font-large); }
            .post-meta { flex-direction: column; align-items: flex-start; gap: 0.5em; }
            .sidebar { display: none; }
            .theme-toggle { right: 0.5em; }
        }
    </style>
</head>
<body>
<div w3-include-html="_header.html"></div>
<div class="container">
    <div class="post-header" id="post-header"></div>
    <div class="post-content" id="post-content"></div>
    <div class="share-section" id="share-section"></div>
    <div class="comments-section" id="comments-section"></div>
    <div class="related-items section">
        <h3 class="section-title">Related Items</h3>
        <div id="related-items" class="scroll-list"></div>
    </div>
</div>
<div w3-include-html="_footer.html"></div>
<script src="https://www.w3schools.com/lib/w3.js"></script>
<script src="https://cdn.jsdelivr.net/npm/faker@5.5.3/dist/faker.min.js"></script>
<script src="_fields.js"></script>
<script src="_data.js"></script>
<script src="_location.js"></script>
<script src="_member.js"></script>
<script src="_common.js"></script>
<script>
    const urlParams = new URLSearchParams(window.location.search);
    const postTitle = decodeURIComponent(urlParams.get('name') || 'Sunt suscipit blanditiis optio ut asperiores vel.');
    const isPaid = Math.random() > 0.5;
    const authorName = faker.name.findName();
    const storeChance = Math.random() > 0.5;
    const storeName = storeChance ? faker.company.companyName() : null;
    const categories = articleCategories[Math.floor(Math.random() * articleCategories.length)];
    const subCategory = categories.sub[Math.floor(Math.random() * categories.sub.length)];
    const brandCount = randomInt(1, 3);
    const brands = hotBrands.sort(() => 0.5 - Math.random()).slice(0, brandCount);
    const tagCount = randomInt(1, 3);
    const tags = generateTag(1, 3);
    const rating = faker.datatype.float({ min: 4, max: 5, precision: 0.1 });
    const ratingCount = faker.datatype.number({ min: 50, max: 300 });
    const favoriteCount = faker.datatype.number({ min: 100, max: 1100 });
    const readCount = faker.datatype.number({ min: 100, max: 1000 });
    const paidCount = isPaid ? faker.datatype.number({ min: 0, max: 50 }) : 0;

    function renderPostHeader() {
        const header = document.getElementById('post-header');
        header.innerHTML = `
            <div class="post-inner">
                <div class="post-info">
                    <h1>${postTitle}</h1>
                    <div class="post-meta">
                        <div class="author">
                            <img src="${getPicsumImage(50, 50, `author-${authorName}`)}" alt="${authorName}">
                            <a href="blog.html?name=${encodeURIComponent(authorName)}">${authorName}</a>
                        </div>
                        ${storeName ? `
                            <div class="store">
                                <img src="${getPicsumImage(50, 50, `store-${storeName}`)}" alt="${storeName}">
                                <a href="store.html?name=${encodeURIComponent(storeName)}">${storeName}</a>
                            </div>
                        ` : ''}
                        <div class="category">
                            <a href="post-list.html?type=${encodeURIComponent(categories.name)}">${categories.name}</a> >
                            <a href="post-list.html?type=${encodeURIComponent(subCategory)}">${subCategory}</a>
                        </div>
                        <div class="brands">
                            ${brands.map(brand => `
                                <div class="brand-item">
                                    <img src="${brand.logo}" alt="${brand.name}">
                                    <span style="color: ${brand.themeColor}">${brand.name}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="tags">
                            ${tags.map(tag => `<span class="ant-tag">${tag}</span>`).join('')}
                        </div>
                        <div class="rating-wrapper">${generateRating({ position: 'left' }, { sample: rating, count: ratingCount }, {})}</div>
                    </div>
                    <div class="stats">
                        <span>Reads: ${readCount}</span>
                        ${isPaid ? `<span>Paid: ${paidCount}</span>` : ''}
                    </div>
                    <div class="favorite-wrapper">
                        <i class="fas fa-heart favorite-icon ${Math.random() > 0.5 ? 'favorited' : ''}" onclick="toggleFavorite(this)"></i>
                        <span>${favoriteCount}</span>
                    </div>
                </div>
            </div>
        `;
    }

    function toggleFavorite(element) {
        element.classList.toggle('favorited');
    }

    function generatePostContent() {
        const paragraphs = [];
        for (let i = 0; i < randomInt(5, 10); i++) {
            const hasImage = Math.random() > 0.7;
            paragraphs.push({
                title: faker.lorem.sentence(),
                content: faker.lorem.paragraphs(1),
                image: hasImage ? getPicsumImage(600, 400, `post-${i}`) : null
            });
        }
        return paragraphs;
    }

    function renderPostContent() {
        const content = document.getElementById('post-content');
        const paragraphs = generatePostContent();
        const freeCount = Math.floor(paragraphs.length / 2);
        let html = '';
        paragraphs.forEach((para, index) => {
            const isPaidSection = isPaid && index >= freeCount;
            html += `
                <h2 id="para-${index}">${para.title}</h2>
                ${para.image ? `<img src="${para.image}" alt="${para.title}" onclick="showImageModal(this.src)">` : ''}
                <p ${isPaidSection ? 'class="paid-section"' : ''}>${para.content}</p>
                ${isPaidSection ? `<div class="paid-overlay" onclick="showPaymentModal()">Unlock for $5</div>` : ''}
            `;
        });
        content.innerHTML = html;

        const sidebar = document.createElement('div');
        sidebar.className = 'sidebar';
        sidebar.innerHTML = `
            <a href="#post-header">${postTitle}</a>
            ${paragraphs.map((para, index) => `<a href="#para-${index}" style="padding-left: 1em">${para.title}</a>`).join('')}
            <a href="#comments-section">Comments</a>
            <a href="#related-items">Related Items</a>
        `;
        content.appendChild(sidebar);

        const themeToggle = document.createElement('i');
        themeToggle.className = 'fas fa-palette theme-toggle';
        themeToggle.onclick = toggleTheme;
        content.appendChild(themeToggle);
    }

    function showImageModal(src) {
        showModal('image-modal', `<img src="${src}" style="max-width: 100%; max-height: 80vh;">`, { style: { width: 'auto', maxWidth: '90%' } });
    }

    const themes = [
        { background: '#FFFFFF', color: '#333333' },
        { background: '#F5F5F5', color: '#333333' },
        { background: '#2C2C2C', color: '#FFFFFF' }
    ];
    let themeIndex = 0;

    function toggleTheme() {
        themeIndex = (themeIndex + 1) % themes.length;
        const content = document.getElementById('post-content');
        content.style.background = themes[themeIndex].background;
        content.style.color = themes[themeIndex].color;
    }

    function showPaymentModal() {
        showModal('payment-modal', `
            <h3>Unlock Paid Content</h3>
            <p>Price: $5</p>
            <button class="btn-orange-solid-medium" onclick="unlockContent()">Confirm Payment</button>
        `);
    }

    function unlockContent() {
        hideModal('payment-modal');
        alert(`Congratulations! You've unlocked the paid content for "${postTitle}"`);
        document.querySelectorAll('.paid-section').forEach(el => el.classList.remove('paid-section'));
        document.querySelectorAll('.paid-overlay').forEach(el => el.remove());
    }

    function renderShareSection() {
        const share = document.getElementById('share-section');
        share.innerHTML = `
            <h3>Share</h3>
            <img src="https://via.placeholder.com/32?text=FB" alt="Facebook" onclick="shareTo('facebook')">
            <img src="https://via.placeholder.com/32?text=TW" alt="Twitter" onclick="shareTo('twitter')">
            <img src="https://via.placeholder.com/32?text=LI" alt="LinkedIn" onclick="shareTo('linkedin')">
        `;
    }

    function shareTo(platform) {
        const url = encodeURIComponent(window.location.href);
        const title = encodeURIComponent(postTitle);
        let shareUrl;
        switch (platform) {
            case 'facebook': shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`; break;
            case 'twitter': shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${title}`; break;
            case 'linkedin': shareUrl = `https://www.linkedin.com/shareArticle?url=${url}&title=${title}`; break;
        }
        window.open(shareUrl, '_blank');
    }

    function renderComments() {
        const commentsSection = document.getElementById('comments-section');
        const commentCount = faker.datatype.number({ min: 50, max: 200 });
        const commentsPerPage = 10;
        const totalPages = Math.ceil(commentCount / commentsPerPage);
        const comments = Array(commentCount).fill().map(() => ({
            user: faker.name.findName(),
            avatar: getPicsumImage(50, 50, `comment-${Math.random()}`),
            rating: faker.datatype.float({ min: 3, max: 5, precision: 0.1 }),
            content: faker.lorem.paragraph()
        }));
        let currentPage = 1;

        function renderCommentList(page) {
            const start = (page - 1) * commentsPerPage;
            const end = start + commentsPerPage;
            const pageComments = comments.slice(start, end);
            let html = `
                <h3>Comments (${commentCount})</h3>
                <div class="comment-list">
                    ${pageComments.map(comment => `
                        <div class="comment-item">
                            <img src="${comment.avatar}" alt="${comment.user}">
                            <div class="comment-content">
                                <strong>${comment.user}</strong>
                                <div class="rating-wrapper">${generateRating({}, { sample: comment.rating, count: 0 }, {})}</div>
                                <p>${comment.content}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div class="pagination">
                    ${Array(totalPages).fill().map((_, i) => `<a href="#" onclick="renderCommentList(${i + 1}); return false;">${i + 1}</a>`).join('')}
                </div>
            `;
            commentsSection.innerHTML = html;
        }

        renderCommentList(currentPage);

        const selfComment = `
            <div class="self-comment">
                <div style="display: flex; align-items: center; gap: 0.5em;">
                    <img src="${getPicsumImage(50, 50, 'self')}" alt="You">
                    <strong>${faker.name.findName()}</strong>
                </div>
                <div class="rating-wrapper" id="self-rating"></div>
                <textarea placeholder="Write your comment..."></textarea>
                <div class="captcha">
                    <input type="text" placeholder="Captcha">
                    <img src="https://via.placeholder.com/100x40?text=Captcha" alt="Captcha">
                </div>
                <button class="btn-orange-solid-medium" onclick="submitComment()">Submit</button>
            </div>
        `;
        commentsSection.innerHTML += selfComment;

        const ratingWrapper = document.getElementById('self-rating');
        ratingWrapper.innerHTML = generateRating({}, { sample: 0, count: 0 }, {});
        ratingWrapper.querySelectorAll('.star').forEach((star, idx) => {
            star.onclick = () => setRating(idx + 1);
        });
    }

    function setRating(value) {
        const ratingWrapper = document.getElementById('self-rating');
        ratingWrapper.innerHTML = generateRating({}, { sample: value, count: 0 }, {});
        ratingWrapper.querySelectorAll('.star').forEach((star, idx) => {
            star.onclick = () => setRating(idx + 1);
        });
    }

    function submitComment() {
        alert('Thank you for your comment!');
    }

    function renderRelatedItems() {
        const items = generateData(itemFieldConfig, 12);
        generateCards('related-items', 'card', items, itemFieldConfig);
    }

    window.onload = () => {
        w3.includeHTML(() => {
            document.title = `${postTitle} - FASTRESP`;
            renderPostHeader();
            renderPostContent();
            renderShareSection();
            renderComments();
            renderRelatedItems();

            const header = document.getElementById('post-header');
            const topHeader = document.querySelector('.header');
            const initialHeight = header.offsetHeight;
            header.style.minHeight = `${initialHeight}px`;
            window.addEventListener('scroll', () => {
                const scrollY = window.scrollY;
                if (scrollY >= initialHeight) {
                    header.classList.add('fixed');
                    topHeader.classList.add('hidden');
                    document.body.style.paddingTop = `${initialHeight}px`;
                } else {
                    header.classList.remove('fixed');
                    topHeader.classList.remove('hidden');
                    document.body.style.paddingTop = "7.4em";
                }
            });
        });
    };
</script>
</body>
</html>